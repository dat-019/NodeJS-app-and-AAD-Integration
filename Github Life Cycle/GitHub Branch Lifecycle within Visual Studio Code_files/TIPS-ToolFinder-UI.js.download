/* 
 This js file implements TIPS customizations to:
   - hide all page components except the  main body content
   - inject the Tips -ToolFinder-UI navigation into the existing content
  
 This utility depents on the jquery plug-in. 
*/ 
(function () { 
     
    "use strict"; 
      
//     var URL_SUPERFISH_JS = "../scripts/superfish.min.js", 
//         LazyLoad = defineLazyLoad(); 
      
	(function () {         
		executeOrWaitUntilJQueryLoaded(function () {
			
			loadTIPSNavigationComponents();
			
		}); 
	}()); 

	//-------------------------------------------------------------------------------------------------------
	//Function to test if a parameter has been provided in the URL
	//
	// parameters:
	//		location = DOM level where the param will be found (top.document.location, window.document.location, parent.document.location...)
	//		param = String representting the name of the parameter that is being tested.
	// Returns:
	//		Boolean: indicating that the parameter was  or was not found in the URL.
	//
	//-------------------------------------------------------------------------------------------------------
	function is_a_URLParam(parm) {
		var rtrnVal=false;

		var urlquery = ""		
		try{
			urlquery = top.document.location.search.substring(1);
		}catch(e) {
			try {
				urlquery = document.location.search.substring(1);
			}catch (e){
				throw e
			}
		}
		
		var pairs = urlquery.split("&"); 
		i=pairs.length-1;
		
		// Get the param Pairs
		for (var i=0; i<pairs.length; i++){
			var pos = pairs[i].indexOf('='); 
			if (pos == -1) {
				argname = pairs[i];
			} else {
				var argname = pairs[i].substring(0,pos); 
			}
			
			// If URL param pair found.
			if (argname==parm){
				rtrnVal=true;
				i=pairs.length; //terminate loop
			}
		}

		return rtrnVal; 
	}

	//-------------------------------------------------------------------------------------------------------
	//Function to get the value for a parameter that may have been provided in the URL
	//
	// parameters:
	//		param = String representting the name of the parameter that is being tested.
	// Returns:
	//		value: string indicating the value of the parameter found in the URL.
	//				if the paramter was not found in the URL, "" is returned.
	//
	//-------------------------------------------------------------------------------------------------------
	function getURLParam(parm) {
	
		var rtrnVal="";
		var urlquery = ""		
		try{
			urlquery = top.document.location.search.substring(1);
		}catch(e) {
			try {
				urlquery = document.location.search.substring(1);
			}catch (e){
				throw e
			}
		}

		var pairs = urlquery.split("&"); 
		i=pairs.length-1;
		
		// Get the param Pairs
		for (var i=0; i<pairs.length; i++){
			var pos = pairs[i].indexOf('='); 
			if (pos == -1) continue;
			var argname = pairs[i].substring(0,pos); 
			var value = pairs[i].substring(pos+1);
			
			// If URL param pair found.
			if (argname==parm){
				rtrnVal=value;
				i=pairs.length; //terminate loop
			}
		}
		rtrnVal = decodeURIComponent(rtrnVal);

		return rtrnVal; 
		
	}	
     function executeOrWaitUntilJQueryLoaded(func) { 
         if (typeof $ === "function") { 
             func(); 
         } else { 
             setTimeout(function () { 
                 executeOrWaitUntilJQueryLoaded(func); 
             }, 20); 
         } 
     } 
	  
	// Function to either:
	//		-	Hide all Navigation Components (if the URL param "UI" was added to URL )
	// or
	//		-	Overwrite the Minimal Mistakes Left Nav with the TIPS navigation and add a 
	//			Tab navigation to references to collection pages in "_pages" and "_posts" files
	//
	function loadTIPSNavigationComponents() {
		var leftNavURL="https://github.dxc.com/pages/AET/TIPS-ToolFinder-UI"
		var tabNavURL= "https://github.dxc.com/pages/AET/TIPS-ToolFinder-UI/tab"

		if (is_a_URLParam("UI")) {
			$(".masthead").hide()					//Hide the Header
			$(".breadcrumbs").hide()				//Hide the Breadcrumbs
			$("#main").children(".sidebar", ".sticky").hide()		//Hide the side Nav
			$(".page__footer").hide()				//Hide the Footer
			$(".github-fork-ribbon").hide()				//Hide the Contribute ribbon
			$("#main").children(".archive").css("float","left")	//Justify the Body Left
		}else if(is_a_URLParam("NAV")) {
			// Set Left Nav
			$("#main").children(".sidebar", ".sticky").html( "<iframe id='left-side-menu'; style='overflow:hidden;border:none'; scrolling='no';>Insert Tab Menu >Here< </iframe>");
			$("#main").children(".sidebar", ".sticky").find("#left-side-menu").prop('src', leftNavURL);
			$("#left-side-menu").width($("#left-side-menu").parent().width());      //set menu width to fill the parent ".sidebar container width;
			$("#left-side-menu").height($("#left-side-menu").parent().height());    //set menu height to fill the parent ".sidebar" container height;
			$("#left-side-menu").parent().css("overflow","hidden");
			
			//If Not the home Page, Set the content Tab Nav
			var pathArray	=top.document.location.pathname.split("/");						// Get the URL Path elements
			pathArray		=pathArray.filter(function(e){return e});						// Fulsh the empty (first and last) values
			var indexLastElmnt	= (pathArray.length-1);										// Get index of last Element in pathArray
			if (pathArray.indexOf("TIPS-ToolFinder") != indexLastElmnt){					// If "TIPS-ToolFinder" is not the last element of the path, we are on a content page
				var contentBody = null;														//		define param for Content Body container
				var contentBodyWidth = null;												//		define param for Content Body container Width
				if ($("#main .archive table").length>0){									//		If we are looking at the Overview page ("_pages") file
					contentBodyWidth	= $("#main .archive table").width()					// 			Get the width of the Overview Content body container
					contentBody 		= $("#main .archive table").prev();					//			Get handle for The body of the Overview page content (below header)
				}else if($("#main article section.page__content").length>0) {				// 		Else If we are looking at the one of the posts page ("_posts") files
					contentBodyWidth	= $("#main article section.page__content").width();	// 			Get the width of the Content body container
					contentBody 		= $("#main article section.page__content").prev();	//			Get handle for The body of the page content (below header)
				}
				var iFrameHTML = "<iframe id='content-tab-menu'; style='overflow:hidden;height:50px;width;100%'; scrolling='no'; frameBorder=0;>Tab menu to be inserted here</iframe>"	
																							// 		Define container parameters for the Tab Menu
				$(iFrameHTML).insertAfter(contentBody);										//		Insert Tab menu Container
				$("#content-tab-menu").width(contentBodyWidth);								//		Set the Iframe width to be the full 
				$("#content-tab-menu").prop("src", tabNavURL);								//		set the SRC url for the IFrame
			}
		}
  }
	
}());
